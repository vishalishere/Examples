/*
 jQuery Easing v1.3: Copyright (c) 2008 George McGinley Smith | BSD License: http://www.opensource.org/licenses/bsd-license.php
 jquery.transloadit2-v2.7.1.js: Copyright (c) 2013 Transloadit Ltd | MIT License: http://www.opensource.org/licenses/mit-license.php

 Fork this on Github: http://github.com/transloadit/jquery-sdk

 Transloadit servers allow browsers to cache jquery.transloadit2.js for 1 hour.
 keep this in mind when rolling out fixes.
 json2: Douglas Crockford | Public domain
 jQuery Tools 1.2.3: Tero Piirainen | Public domain
*/
jQuery.easing.jswing=jQuery.easing.swing;
jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(d,a,c,b,e){return jQuery.easing[jQuery.easing.def](d,a,c,b,e)},easeInQuad:function(d,a,c,b,e){return b*(a/=e)*a+c},easeOutQuad:function(d,a,c,b,e){return-b*(a/=e)*(a-2)+c},easeInOutQuad:function(d,a,c,b,e){return 1>(a/=e/2)?b/2*a*a+c:-b/2*(--a*(a-2)-1)+c},easeInCubic:function(d,a,c,b,e){return b*(a/=e)*a*a+c},easeOutCubic:function(d,a,c,b,e){return b*((a=a/e-1)*a*a+1)+c},easeInOutCubic:function(d,a,c,b,e){return 1>(a/=e/2)?b/2*a*a*a+c:
b/2*((a-=2)*a*a+2)+c},easeInQuart:function(d,a,c,b,e){return b*(a/=e)*a*a*a+c},easeOutQuart:function(d,a,c,b,e){return-b*((a=a/e-1)*a*a*a-1)+c},easeInOutQuart:function(d,a,c,b,e){return 1>(a/=e/2)?b/2*a*a*a*a+c:-b/2*((a-=2)*a*a*a-2)+c},easeInQuint:function(d,a,c,b,e){return b*(a/=e)*a*a*a*a+c},easeOutQuint:function(d,a,c,b,e){return b*((a=a/e-1)*a*a*a*a+1)+c},easeInOutQuint:function(d,a,c,b,e){return 1>(a/=e/2)?b/2*a*a*a*a*a+c:b/2*((a-=2)*a*a*a*a+2)+c},easeInSine:function(d,a,c,b,e){return-b*Math.cos(a/
e*(Math.PI/2))+b+c},easeOutSine:function(d,a,c,b,e){return b*Math.sin(a/e*(Math.PI/2))+c},easeInOutSine:function(d,a,c,b,e){return-b/2*(Math.cos(Math.PI*a/e)-1)+c},easeInExpo:function(d,a,c,b,e){return 0==a?c:b*Math.pow(2,10*(a/e-1))+c},easeOutExpo:function(d,a,c,b,e){return a==e?c+b:b*(-Math.pow(2,-10*a/e)+1)+c},easeInOutExpo:function(d,a,c,b,e){return 0==a?c:a==e?c+b:1>(a/=e/2)?b/2*Math.pow(2,10*(a-1))+c:b/2*(-Math.pow(2,-10*--a)+2)+c},easeInCirc:function(d,a,c,b,e){return-b*(Math.sqrt(1-(a/=e)*
a)-1)+c},easeOutCirc:function(d,a,c,b,e){return b*Math.sqrt(1-(a=a/e-1)*a)+c},easeInOutCirc:function(d,a,c,b,e){return 1>(a/=e/2)?-b/2*(Math.sqrt(1-a*a)-1)+c:b/2*(Math.sqrt(1-(a-=2)*a)+1)+c},easeInElastic:function(d,a,c,b,e){d=1.70158;var g=0,h=b;if(0==a)return c;if(1==(a/=e))return c+b;g||(g=.3*e);h<Math.abs(b)?(h=b,d=g/4):d=g/(2*Math.PI)*Math.asin(b/h);return-(h*Math.pow(2,10*--a)*Math.sin(2*(a*e-d)*Math.PI/g))+c},easeOutElastic:function(d,a,c,b,e){d=1.70158;var g=0,h=b;if(0==a)return c;if(1==(a/=
e))return c+b;g||(g=.3*e);h<Math.abs(b)?(h=b,d=g/4):d=g/(2*Math.PI)*Math.asin(b/h);return h*Math.pow(2,-10*a)*Math.sin(2*(a*e-d)*Math.PI/g)+b+c},easeInOutElastic:function(d,a,c,b,e){d=1.70158;var g=0,h=b;if(0==a)return c;if(2==(a/=e/2))return c+b;g||(g=.3*e*1.5);h<Math.abs(b)?(h=b,d=g/4):d=g/(2*Math.PI)*Math.asin(b/h);return 1>a?-.5*h*Math.pow(2,10*--a)*Math.sin(2*(a*e-d)*Math.PI/g)+c:h*Math.pow(2,-10*--a)*Math.sin(2*(a*e-d)*Math.PI/g)*.5+b+c},easeInBack:function(d,a,c,b,e,g){void 0==g&&(g=1.70158);
return b*(a/=e)*a*((g+1)*a-g)+c},easeOutBack:function(d,a,c,b,e,g){void 0==g&&(g=1.70158);return b*((a=a/e-1)*a*((g+1)*a+g)+1)+c},easeInOutBack:function(d,a,c,b,e,g){void 0==g&&(g=1.70158);return 1>(a/=e/2)?b/2*a*a*(((g*=1.525)+1)*a-g)+c:b/2*((a-=2)*a*(((g*=1.525)+1)*a+g)+2)+c},easeInBounce:function(d,a,c,b,e){return b-jQuery.easing.easeOutBounce(d,e-a,0,b,e)+c},easeOutBounce:function(d,a,c,b,e){return(a/=e)<1/2.75?7.5625*b*a*a+c:a<2/2.75?b*(7.5625*(a-=1.5/2.75)*a+.75)+c:a<2.5/2.75?b*(7.5625*(a-=
2.25/2.75)*a+.9375)+c:b*(7.5625*(a-=2.625/2.75)*a+.984375)+c},easeInOutBounce:function(d,a,c,b,e){return a<e/2?.5*jQuery.easing.easeInBounce(d,2*a,0,b,e)+c:.5*jQuery.easing.easeOutBounce(d,2*a-e,0,b,e)+.5*b+c}});
(function(d){function a(){}function c(a){u=[a]}function b(a,f,m){return a&&a.apply(f.context||f,m)}function e(e){function x(a){B++||(C(),D&&(m[r]={s:[a]}),E&&(a=E.apply(e,[a])),b(k,e,[a,"success",e]),b(w,e,[e,"success"]))}function p(a){B++||(C(),D&&"timeout"!=a&&(m[r]=a),b(t,e,[e,a]),b(w,e,[e,a]))}e=d.extend({},H,e);var k=e.success,t=e.error,w=e.complete,E=e.dataFilter,v=e.callbackParameter,I=e.callback,L=e.cache,D=e.pageCache,J=e.charset,r=e.url,y=e.data,K=e.timeout,F,B=0,C=a,q,A,G;h&&h(function(a){a.done(k).fail(t);
k=a.resolve;t=a.reject}).promise(e);e.abort=function(){!B++&&C()};if(!1===b(e.beforeSend,e,[e])||B)return e;r=r||"";y=y?"string"==typeof y?y:d.param(y,e.traditional):"";r+=y?(/\?/.test(r)?"&":"?")+y:"";v&&(r+=(/\?/.test(r)?"&":"?")+encodeURIComponent(v)+"=?");L||D||(r+=(/\?/.test(r)?"&":"?")+"_"+(new Date).getTime()+"=");r=r.replace(/=\?(&|$)/,"="+I+"$1");D&&(F=m[r])?F.s?x(F.s[0]):p(F):(g[I]=c,q=d("<script>")[0],q.id="_jqjsp"+f++,J&&(q.charset=J),l&&11.6>l.version()?(A=d("<script>")[0]).text="document.getElementById('"+
q.id+"').onerror()":q.async="async",M&&(q.htmlFor=q.id,q.event="onclick"),q.onload=q.onerror=q.onreadystatechange=function(a){if(!q.readyState||!/i/.test(q.readyState)){try{q.onclick&&q.onclick()}catch(f){}a=u;u=0;a?x(a[0]):p("error")}},q.src=r,C=function(a){G&&clearTimeout(G);q.onreadystatechange=q.onload=q.onerror=null;n.removeChild(q);A&&n.removeChild(A)},n.insertBefore(q,v=n.firstChild),A&&n.insertBefore(A,v),G=0<K&&setTimeout(function(){p("timeout")},K));return e}var g=window,h=d.Deferred,n=
d("head")[0]||document.documentElement,m={},f=0,u,H={callback:"_jqjsp",url:location.href},l=g.opera,M=!!d("<div>").html("\x3c!--[if IE]><i><![endif]--\x3e").find("i").length;e.setup=function(a){d.extend(H,a)};d.jsonp=e})(jQuery);this.JSON||(this.JSON={});
(function(){function d(a){return 10>a?"0"+a:a}function a(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var f=n[a];return"string"===typeof f?f:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(f,e){var b,l,d,z,x=g,p,k=e[f];k&&"object"===typeof k&&"function"===typeof k.toJSON&&(k=k.toJSON(f));"function"===typeof m&&(k=m.call(e,f,k));switch(typeof k){case "string":return a(k);case "number":return isFinite(k)?String(k):"null";case "boolean":case "null":return String(k);
case "object":if(!k)return"null";g+=h;p=[];if("[object Array]"===Object.prototype.toString.apply(k)){z=k.length;for(b=0;b<z;b+=1)p[b]=c(b,k)||"null";d=0===p.length?"[]":g?"[\n"+g+p.join(",\n"+g)+"\n"+x+"]":"["+p.join(",")+"]";g=x;return d}if(m&&"object"===typeof m)for(z=m.length,b=0;b<z;b+=1)l=m[b],"string"===typeof l&&(d=c(l,k))&&p.push(a(l)+(g?": ":":")+d);else for(l in k)Object.hasOwnProperty.call(k,l)&&(d=c(l,k))&&p.push(a(l)+(g?": ":":")+d);d=0===p.length?"{}":g?"{\n"+g+p.join(",\n"+g)+"\n"+
x+"}":"{"+p.join(",")+"}";g=x;return d}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+d(this.getUTCMonth()+1)+"-"+d(this.getUTCDate())+"T"+d(this.getUTCHours())+":"+d(this.getUTCMinutes())+":"+d(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,h,n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,b,e){var d;h=g="";if("number"===typeof e)for(d=0;d<e;d+=1)h+=" ";else"string"===typeof e&&(h=e);if((m=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return c("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,m){function e(a,f){var b,d,c=a[f];if(c&&"object"===typeof c)for(b in c)Object.hasOwnProperty.call(c,b)&&(d=e(c,b),void 0!==d?c[b]=d:delete c[b]);return m.call(a,f,c)}var d;a=String(a);b.lastIndex=0;b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"===typeof m?e({"":d},""):d;throw new SyntaxError("JSON.parse");})})();
(function(d){d.tools=d.tools||{version:"2013-02-15"};var a=d.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",zIndex:9998,opacity:.8,startOpacity:0,color:"#fff"}},c,b,e,g,h;d.mask={load:function(n,m){if(e)return this;n=n||g;g=n=d.extend(d.extend({},a.conf),n);c=d("#"+n.maskId);c.length||(c=d("<div/>").attr("id",n.maskId),d("body").append(c));c.css({position:"fixed",top:0,left:0,width:"100%",height:"100%",display:"block",opacity:n.opacity,zIndex:n.zIndex,backgroundColor:n.color});
m&&m.length&&(h=m.eq(0).css("zIndex"),b=m.css({zIndex:Math.max(n.zIndex+1,"auto"==h?0:h)}));e=!0;return this},close:function(){e&&(c.fadeOut(g.closeSpeed,function(){b&&b.css({zIndex:h})}),e=!1);return this}};d.fn.mask=function(a){d.mask.load(a);return this};d.fn.expose=function(a){d.mask.load(a,this);return this}})(jQuery);
!function(d){function a(a,f){f=f||[];return a.replace(/(%[s])/g,function(a,m,b){return(a=f.shift())||0===a?a+"":""})}function c(){this.timer=this.documentTitle=this.instance=this.assemblyId=null;this._options={};this.uploads=[];this.results={};this.pollStarted=this.ended=null;this.pollRetries=0;this.started=!1;this.params=this.assembly=null;this.lastPoll=this.bytesReceivedBefore=0;this.$modal=this.$iframe=this.$fileClones=this.$files=this.$form=this.$params=null;this._clockseq=this._lastNSecs=this._lastMSecs=
0;this._animatedTo100=!1;this._uploadFileIds=[];this._resultFileIds=[]}var b="https:"==document.location.protocol?"https://":"http://",e=b+"api2.transloadit.com/",g={service:e,assets:b+"assets.transloadit.com/",beforeStart:function(){return!0},onFileSelect:function(){},onStart:function(){},onProgress:function(){},onUpload:function(){},onResult:function(){},onCancel:function(){},onError:function(){},onSuccess:function(){},interval:2500,pollTimeout:8E3,poll404Retries:15,pollConnectionRetries:5,wait:!1,
processZeroFiles:!0,triggerUploadOnFileSelection:!1,autoSubmit:!0,modal:!0,exclude:"",fields:!1,params:null,signature:null,region:"us-east-1",debug:!0,locale:"en"},h={en:{"errors.BORED_INSTANCE_ERROR":"Could not find a bored instance.","errors.CONNECTION_ERROR":"There was a problem connecting to the upload server","errors.unknown":"There was an internal error.","errors.tryAgain":"Please try your upload again.","errors.troubleshootDetails":"If you would like our help to troubleshoot this, please email us this information:",
cancel:"Cancel",details:"Details",startingUpload:"Starting upload ...",processingFiles:"Upload done, now processing files ...",uploadProgress:"%s / %s MB at %s kB/s | %s left"},ja:{"errors.BORED_INSTANCE_ERROR":"\u30b5\u30fc\u30d0\u30fc\u63a5\u7d9a\u306b\u554f\u984c\u304c\u3042\u308a\u307e\u3059","errors.CONNECTION_ERROR":"\u30b5\u30fc\u30d0\u30fc\u63a5\u7d9a\u306b\u554f\u984c\u304c\u3042\u308a\u307e\u3059","errors.unknown":"\u901a\u4fe1\u74b0\u5883\u306b\u554f\u984c\u304c\u3042\u308a\u307e\u3059",
"errors.tryAgain":"\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u518d\u5ea6\u6295\u7a3f\u3057\u3066\u304f\u3060\u3055\u3044","errors.troubleshootDetails":"\u89e3\u6c7a\u3067\u304d\u306a\u3044\u5834\u5408\u306f\u3001\u3053\u3061\u3089\u306b\u304a\u554f\u3044\u5408\u308f\u305b\u304f\u3060\u3055\u3044 \u4e0b\u8a18\u306e\u60c5\u5831\u3092\u30e1\u30fc\u30eb\u3067\u304a\u9001\u308a\u304f\u3060\u3055\u3044:",cancel:"\u30ad\u30e3\u30f3\u30bb\u30eb",details:"\u8a73\u7d30",startingUpload:"\u6295\u7a3f\u4e2d ...",
processingFiles:"\u63a5\u7d9a\u4e2d",uploadProgress:"%s MB / %s MB (%s kB / \u79d2)"}},n=!1;d.fn.transloadit=function(){var a=Array.prototype.slice.call(arguments),f,b;if(0!==this.length)if(1<this.length)this.each(function(){d.fn.transloadit.apply(d(this),a)});else{(1==a.length&&"object"==typeof a[0]||void 0===a[0])&&a.unshift("init");f=a.shift();"init"==f?(b=new c,a.unshift(this),this.data("transloadit.uploader",b)):b=this.data("transloadit.uploader");if(!b)throw Error("Element is not initialized for transloadit!");
f=b[f].apply(b,a);return void 0===f?this:f}};d.fn.transloadit.i18n=h;c.prototype.init=function(a,f){this.$form=a;this.options(d.extend({},g,f||{}));var b=this;a.bind("submit.transloadit",function(){b.validate();b.detectFileInputs();b._options.processZeroFiles||0!==b.$files.length?b._options.beforeStart()&&b.getBoredInstance():b._options.beforeStart()&&b.submitForm();return!1});if(this._options.triggerUploadOnFileSelection)a.on("change",'input[type="file"]',function(){a.trigger("submit.transloadit")});
a.on("change",'input[type="file"]',function(){b._options.onFileSelect(d(this).val(),d(this))});this.includeCss()};c.prototype.getBoredInstance=function(){function a(){d.jsonp({url:c,timeout:f._options.pollTimeout,callbackParameter:"callback",success:function(a){a.error?(f.ended=!0,a.url=c,f.renderError(a),f._options.onError(a)):(f.instance=a.api2_host,f.start())},error:function(d,h,z){g&&f._options.service===e?(g=!1,f._findBoredInstanceUrl(function(d,e){d?(f.ended=!0,d={error:"BORED_INSTANCE_ERROR",
message:f.i18n("errors.BORED_INSTANCE_ERROR")+" "+d.message},f.renderError(d),f._options.onError(d)):(c=b+"api2."+e+"/instances/bored",a())})):(f.ended=!0,d="JSONP bored instance request status: "+h+(", err: "+z),d={error:"CONNECTION_ERROR",message:f.i18n("errors.CONNECTION_ERROR"),reason:d,url:c},f.renderError(d),f._options.onError(d))}})}var f=this;this.instance=null;var c=this._options.service+"instances/bored",g=!0;a();this._options.modal&&this.showModal()};c.prototype._findBoredInstanceUrl=function(a){var f=
this,c=this._options.region,e="s3";"us-east-1"!==c&&(e="s3-"+c);var l=b+e+".amazonaws.com/infra-"+c,l=l+".transloadit.com/cached_instances.json";d.ajax({url:l,datatype:"json",timeout:5E3,success:function(b){b=f._shuffle(b.uploaders);f._findResponsiveInstance(b,0,a)},error:function(f,b){a(Error("Could not query S3 for cached uploaders from url: "+l))}})};c.prototype._findResponsiveInstance=function(a,f,c){if(!a[f])return c(Error("No responsive uploaders"));var e=this,l=a[f];d.jsonp({url:b+l,timeout:3E3,
callbackParameter:"callback",success:function(a){c(null,l)},error:function(b,d){e._findResponsiveInstance(a,f+1,c)}})};c.prototype._shuffle=function(a){for(var f=[],b,d=0;d<a.length;d++)b=Math.floor(Math.random()*(d+1)),f[d]=f[b],f[b]=a[d];return f};c.prototype.start=function(){var a=this;this.ended=this.started=!1;this.pollRetries=this.bytesReceivedBefore=0;this.uploads=[];this._animatedTo100=!1;this._uploadFileIds=[];this._resultFileIds=[];this.results={};this.assemblyId=this._genUuid();this.$fileClones=
d().not(document);this.$files.each(function(){var f=d(this).clone(!0);a.$fileClones=a.$fileClones.add(f);f.insertAfter(this)});this.$iframe=d('<iframe id="transloadit-'+this.assemblyId+'" name="transloadit-'+this.assemblyId+'"/>').appendTo("body").hide();var f=b+this.instance+"/assemblies/"+this.assemblyId+"?redirect=false";if(this._options.formData){var c=this.$form.find("input[name=params]").val();if(this._options.formData instanceof FormData)this._options.formData.append("params",c);else{var e=
new FormData(this.$form);e.append("params",c);for(c=0;c<this._options.formData.length;c++){var l=this._options.formData[c];e.append(l[0],l[1],l[2])}this._options.formData=e}e=new XMLHttpRequest;e.open("POST",f);e.send(this._options.formData)}else{this.$uploadForm=d('<form enctype="multipart/form-data" />').attr("action",f).attr("target","transloadit-"+this.assemblyId).attr("method","POST").append(this.$files).appendTo("body").hide();f="[name=params], [name=signature]";!0===this._options.fields?f=
"*":"string"===typeof this._options.fields&&(f+=", "+this._options.fields);c=this.$form.find(":input[type!=file]").filter(f);f=c.filter("select");c=c.filter(function(){return!d(this).is("select")});c=c.filter("[type!=submit]");c=this.clone(c);this._options.params&&!this.$params&&(c=c.add('<input name="params" value=\''+JSON.stringify(this._options.params)+"'>"));this._options.signature&&(c=c.add('<input name="signature" value=\''+this._options.signature+"'>"));if("object"==typeof this._options.fields)for(e in this._options.fields)c=
c.add('<input name="'+e+"\" value='"+this._options.fields[e]+"'>");c.prependTo(this.$uploadForm);f.each(function(){d('<input type="hidden"/>').attr("name",d(this).attr("name")).attr("value",d(this).val()).prependTo(a.$uploadForm)});this.$uploadForm.submit()}this.lastPoll=+new Date;setTimeout(function(){a._poll()},300)};c.prototype.clone=function(a){var f=a.clone();a=a.filter("textarea");for(var c=f.filter("textarea"),b=0;b<a.length;++b)d(c[b]).val(d(a[b]).val());return f};c.prototype.detectFileInputs=
function(){var a=this.$form.find("input[type=file]").not(this._options.exclude);this._options.processZeroFiles||(a=a.filter(function(){return""!==this.value}));this.$files=a};c.prototype.validate=function(){if(this._options.params)this.params=this._options.params;else{var a=this.$form.find("input[name=params]");if(!a.length){alert("Could not find input[name=params] in your form.");return}this.$params=a;try{this.params=JSON.parse(a.val())}catch(b){alert("Error: input[name=params] seems to contain invalid JSON.");
return}}this.params.redirect_url?this.$form.attr("action",this.params.redirect_url):this._options.autoSubmit&&this.$form.attr("action")==this._options.service+"assemblies"&&alert("Error: input[name=params] does not include a redirect_url")};c.prototype._poll=function(a){var f=this;if(!this.ended){var c=/(mozilla)(?:.*? rv:([\w.]+))?/.exec(navigator.userAgent),c=c&&c[1];this.documentTitle=document.title;c&&!this.documentTitle&&(document.title="Loading...");this.pollStarted=+new Date;var e=b+("status-"+
this.instance)+"/assemblies/"+this.assemblyId;a&&(e+=a);d.jsonp({url:e,timeout:f._options.pollTimeout,callbackParameter:"callback",success:function(a){if(!f.ended)if(f.assembly=a,"ASSEMBLY_NOT_FOUND"==a.error)f.pollRetries++,f.pollRetries>f._options.poll404Retries?(document.title=f.documentTitle,f.ended=!0,f.renderError(a),f._options.onError(a)):setTimeout(function(){f._poll()},400);else if(a.error)f.ended=!0,f.renderError(a),document.title=f.documentTitle,f._options.onError(a);else{!f.started&&0<
a.bytes_expected&&(f.started=!0,f._options.onStart(a));f.pollRetries=0;var c="ASSEMBLY_EXECUTING"===a.ok,b="ASSEMBLY_CANCELED"===a.ok,e="ASSEMBLY_COMPLETED"===a.ok;if(0<a.bytes_expected)f._options.onProgress(a.bytes_received,a.bytes_expected,a);for(var m=0;m<a.uploads.length;m++){var g=a.uploads[m];-1===d.inArray(g.id,f._uploadFileIds)&&(f._options.onUpload(g,a),f.uploads.push(g),f._uploadFileIds.push(g.id))}for(var u in a.results)for(f.results[u]=f.results[u]||[],m=0;m<a.results[u].length;m++){var g=
a.results[u][m],h=u+"_"+g.id;-1===d.inArray(h,f._resultFileIds)&&(f._options.onResult(u,g,a),f.results[u].push(g),f._resultFileIds.push(h))}b?(f.ended=!0,document.title=f.documentTitle,f._options.onCancel(a)):(c=e||!f._options.wait&&c,0<a.bytes_expected&&f.renderProgress(a,c,f._options.wait),c?(f.ended=!0,document.title=f.documentTitle,a.uploads=f.uploads,a.results=f.results,f._options.onSuccess(a),setTimeout(function(){f._options.modal&&f.cancel();f.submitForm()},600)):(a=f.pollStarted-+new Date,
f.timer=setTimeout(function(){f._poll()},a<f._options.interval?f._options.interval:a),f.lastPoll=+new Date))}},error:function(a,c,b){f.ended||(f.pollRetries++,f.pollRetries>f._options.pollConnectionRetries?(document.title=f.documentTitle,f.ended=!0,a="JSONP status poll request status: "+c+(", err: "+b),a={error:"CONNECTION_ERROR",message:f.i18n("errors.CONNECTION_ERROR"),reason:a,url:e},f.renderError(a),f._options.onError(a)):setTimeout(function(){f._poll()},350))}})}};c.prototype.stop=function(){document.title=
this.documentTitle;this.ended=!0};c.prototype.cancel=function(){if(!this.ended){var a=this;this.$params&&this.$params.prependTo(this.$form);this.$fileClones.each(function(c){c=d(a.$files[c]).clone(!0);var b=d(this);c.insertAfter(b);b.remove()});clearTimeout(a.timer);this._poll("?method=delete");"Microsoft Internet Explorer"==navigator.appName&&this.$iframe[0].contentWindow.document.execCommand("Stop");setTimeout(function(){a.$iframe.remove()},500)}this._options.modal&&this.hideModal()};c.prototype.submitForm=
function(){"multipart/form-data"===this.$form.attr("enctype")&&this.$form.removeAttr("enctype");null!==this.assembly&&d("<textarea/>").attr("name","transloadit").text(JSON.stringify(this.assembly)).prependTo(this.$form).hide();this._options.autoSubmit&&this.$form.unbind("submit.transloadit").submit()};c.prototype.hideModal=function(){d.mask.close();this.$modal.remove()};c.prototype.showModal=function(){this.$modal=d('<div id="transloadit"><div class="content"><a href="#close" class="close">'+this.i18n("cancel")+
'</a><p class="status"></p><div class="progress progress-striped"><div class="bar"><span class="percent"></span></div></div><label>'+this.i18n("startingUpload")+'</label><p class="error"></p><div class="error-details-toggle"><a href="#">'+this.i18n("details")+'</a></div><p class="error-details"></p></div></div>').appendTo("body");d.extend(this.$modal,{$content:this.$modal.find(".content"),$close:this.$modal.find(".close"),$label:this.$modal.find("label"),$progress:this.$modal.find(".progress"),$percent:this.$modal.find(".progress .percent"),
$progressBar:this.$modal.find(".progress .bar"),$error:this.$modal.find(".error"),$errorDetails:this.$modal.find(".error-details"),$errorDetailsToggle:this.$modal.find(".error-details-toggle")});var a=this;this.$modal.$error.hide();this.$modal.$errorDetails.hide();this.$modal.$errorDetailsToggle.hide();this.$modal.expose({api:!0,maskId:"transloadit_expose",opacity:.9,loadSpeed:250,closeOnEsc:!1,closeOnClick:!1});this.$modal.$close.click(function(){a.cancel();return!1})};c.prototype.renderError=function(a){if(this._options.modal){if(!this._options.debug)return this.cancel();
this.$modal.$content.addClass("content-error");this.$modal.$progress.hide();this.$modal.$label.hide();var c=a.error+": "+a.message+"<br /><br />",c=c+(a.reason||"");if(-1===d.inArray(a.error,["CONNECTION_ERROR","BORED_INSTANCE_ERROR","ASSEMBLY_NOT_FOUND"]))this.$modal.$error.html(c).show();else{var e=this.i18n("errors.unknown")+"<br/>"+this.i18n("errors.tryAgain");this.$modal.$error.html(e).show();var g=a.assemblyId?a.assemblyId:this.assemblyId,l=this,h=null;d.getJSON(b+"jsonip.com/",function(a){h=
a.ip}).always(function(){var e={endpoint:a.url,instance:l.instance,assembly_id:g,ip:h,time:l.getUTCDatetime(),agent:navigator.userAgent,poll_retries:l.pollRetries,error:c};d.post(b+"status.transloadit.com/client_error",e);var u=[],p;for(p in e)u.push(p+": "+e[p]);e=l.i18n("errors.troubleshootDetails")+"<br /><br />";l.$modal.$errorDetails.hide().html(e+u.join("<br />"));l.$modal.$errorDetailsToggle.show().find("a").off("click").on("click",function(a){a.preventDefault();l.$modal.$errorDetails.toggle()})})}}};
c.prototype.renderProgress=function(a,c,b){if(this._options.modal){var e=a.bytes_received/a.bytes_expected*100;100<e&&(e=0);var d=a.bytes_received-this.bytesReceivedBefore,g=+new Date-this.lastPoll,h=100===e?1E3:2*this._options.interval,n=(a.bytes_received/1024/1024).toFixed(2),p=(a.bytes_expected/1024/1024).toFixed(2),k=(d/1024/(g/1E3)).toFixed(1),t=a.bytes_expected-a.bytes_received,g=(d/(g/1E3)).toFixed(1),w="";0<g&&(w=this._duration(t/g));txt=this.i18n("uploadProgress",n,p,k,w);this._animatedTo100||
this.$modal.$label.text(txt);var E=parseInt(this.$modal.$progress.css("width"),10);this.bytesReceivedBefore=a.bytes_received;if(!(0>=d)||c){var v=this;c&&b&&(h=500);this.$modal.$progressBar.stop().animate({width:e+"%"},{duration:h,easing:"linear",progress:function(a,c,b){a=(100*parseInt(v.$modal.$progressBar.css("width"),10)/E).toFixed(0);100<a&&(a=100);13<a&&!v._animatedTo100&&v.$modal.$percent.text(a+"%");100!=a||v._animatedTo100||(v._animatedTo100=!0,setTimeout(function(){v.$modal.$label.text(v.i18n("processingFiles"));
v.$modal.$progress.addClass("active");v.$modal.$percent.text("")},500))}})}}};c.prototype.includeCss=function(){!n&&this._options.modal&&(n=!0,d('<link rel="stylesheet" type="text/css" href="'+this._options.assets+'css/transloadit2-v2.7.1.css" />').appendTo("head"))};c.prototype.getUTCDatetime=function(){var a=new Date,a=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds()),c=function(a){return 10>a?"0"+a:a},b=a.getTimezoneOffset(),e=(0<b?
"-":"+")+c(parseInt(b/60,10));0!==b%60&&(e+=c(b%60));0===b&&(e="Z");return a.getFullYear()+"-"+c(a.getMonth()+1)+"-"+c(a.getDate())+"T"+c(a.getHours())+":"+c(a.getMinutes())+":"+c(a.getSeconds())+e};c.prototype._duration=function(a){var c=Math.floor(a/3600);a-=3600*c;var b=Math.floor(a/60);a-=60*b;var e="";0<c&&(e+=c+"h ");0<b&&(e+=b+"min ");0<a&&(a=a.toFixed(0),e+=a+"s");""===e&&(e="0s");return e};c.prototype._genUuid=function(a,c,b){function e(a,c){var b=c||0,d=p;return d[a[b++]]+d[a[b++]]+d[a[b++]]+
d[a[b++]]+d[a[b++]]+d[a[b++]]+d[a[b++]]+d[a[b++]]+d[a[b++]]+d[a[b++]]+d[a[b++]]+d[a[b++]]+d[a[b++]]+d[a[b++]]+d[a[b++]]+d[a[b++]]}a=a||{};b=c&&b||0;var d=c||[],g=Array(16),h=function(){for(var a=0,b;16>a;a++)0===(a&3)&&(b=4294967296*Math.random()),g[a]=b>>>((a&3)<<3)&255;return g}(),n=[h[0]|1,h[1],h[2],h[3],h[4],h[5]];this._clockseq=(h[6]<<8|h[7])&16383;for(var h=null!=a.clockseq?a.clockseq:this._clockseq,p=[],k=0;256>k;k++)p[k]=(k+256).toString(16).substr(1);var k=null!=a.msecs?a.msecs:(new Date).getTime(),
t=null!=a.nsecs?a.nsecs:this._lastNSecs+1,w=k-this._lastMSecs+(t-this._lastNSecs)/1E4;0>w&&null==a.clockseq&&(h=h+1&16383);(0>w||k>this._lastMSecs)&&null==a.nsecs&&(t=0);if(1E4<=t)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");this._lastMSecs=k;this._lastNSecs=t;this._clockseq=h;k+=122192928E5;t=(1E4*(k&268435455)+t)%4294967296;d[b++]=t>>>24&255;d[b++]=t>>>16&255;d[b++]=t>>>8&255;d[b++]=t&255;k=k/4294967296*1E4&268435455;d[b++]=k>>>8&255;d[b++]=k&255;d[b++]=k>>>24&15|16;d[b++]=k>>>
16&255;d[b++]=h>>>8|128;d[b++]=h&255;a=a.node||n;for(n=0;6>n;n++)d[b+n]=a[n];return c?c:e(d)};c.prototype.options=function(a){if(0===arguments.length)return this._options;d.extend(this._options,a)};c.prototype.option=function(a,b){if(1==arguments.length)return this._options[a];this._options[a]=b};c.prototype.i18n=function(){var b=Array.prototype.slice.call(arguments),c=b.shift(),d=this._options.locale,d=h[d]&&h[d][c]||h.en[c];if(!d)throw Error("Unknown i18n key: "+c);return a(d,b)}}(window.jQuery);
